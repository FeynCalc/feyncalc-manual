% !TeX program = pdflatex
% !TeX root = Expansions.tex

\documentclass[../FeynCalcManual.tex]{subfiles}
\begin{document}
\hypertarget{expanding and undoing expansions}{
\section{Expanding and undoing expansions}\label{expanding and undoing expansions}\index{Expanding and undoing expansions}}

\subsection{See also}

\hyperlink{toc}{Overview}.

\subsection{Manipulations}\label{manipulations}

FeynCalc offers further useful functions for the manipulations of
Lorentz tensors and Dirac matrices. To expand scalar products

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ex1 }\ExtensionTok{=}\NormalTok{ SP}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q} \SpecialCharTok{+} \FunctionTok{r}\OperatorTok{,} \FunctionTok{s} \SpecialCharTok{+} \FunctionTok{t}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
(\overline{p}+\overline{q}+\overline{r})\cdot (\overline{s}+\overline{t})
\end{dmath*}

or expressions like

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ex2 }\ExtensionTok{=}\NormalTok{ FV}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q} \SpecialCharTok{+} \FunctionTok{r}\OperatorTok{,} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left(\overline{p}+\overline{q}+\overline{r}\right)^{\mu }
\end{dmath*}

one can use

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ExpandScalarProduct}\OperatorTok{[}\NormalTok{ex1}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\overline{p}\cdot \overline{s}+\overline{p}\cdot \overline{t}+\overline{q}\cdot \overline{s}+\overline{q}\cdot \overline{t}+\overline{r}\cdot \overline{s}+\overline{r}\cdot \overline{t}
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ExpandScalarProduct}\OperatorTok{[}\NormalTok{ex2}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\overline{p}^{\mu }+\overline{q}^{\mu }+\overline{r}^{\mu }
\end{dmath*}

Notice that \texttt{ExpandScalarProduct} can also do expansions only for
the given momentum, while leaving the rest of the expression untouched,
e.g.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{x}\NormalTok{ SP}\OperatorTok{[}\NormalTok{p1 }\SpecialCharTok{+}\NormalTok{ p2}\OperatorTok{,}\NormalTok{ q1 }\SpecialCharTok{+}\NormalTok{ q2}\OperatorTok{]} \SpecialCharTok{+} \FunctionTok{y}\NormalTok{ SP}\OperatorTok{[}\NormalTok{p3 }\SpecialCharTok{+}\NormalTok{ p4}\OperatorTok{,}\NormalTok{ q3 }\SpecialCharTok{+}\NormalTok{ q4}\OperatorTok{]} \SpecialCharTok{+} \FunctionTok{z}\NormalTok{ SP}\OperatorTok{[}\NormalTok{p5 }\SpecialCharTok{+}\NormalTok{ p6}\OperatorTok{,}\NormalTok{ q5 }\SpecialCharTok{+}\NormalTok{ q6}\OperatorTok{]}
\NormalTok{ExpandScalarProduct}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{,}\NormalTok{ Momentum }\OtherTok{{-}\textgreater{}} \OperatorTok{\{}\NormalTok{p1}\OperatorTok{\}]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
x \left((\overline{\text{p1}}+\overline{\text{p2}})\cdot (\overline{\text{q1}}+\overline{\text{q2}})\right)+y \left((\overline{\text{p3}}+\overline{\text{p4}})\cdot (\overline{\text{q3}}+\overline{\text{q4}})\right)+z \left((\overline{\text{p5}}+\overline{\text{p6}})\cdot (\overline{\text{q5}}+\overline{\text{q6}})\right)
\end{dmath*}

\begin{dmath*}\breakingcomma
x \left(\overline{\text{p1}}\cdot (\overline{\text{q1}}+\overline{\text{q2}})+\overline{\text{p2}}\cdot (\overline{\text{q1}}+\overline{\text{q2}})\right)+y \left((\overline{\text{p3}}+\overline{\text{p4}})\cdot (\overline{\text{q3}}+\overline{\text{q4}})\right)+z \left((\overline{\text{p5}}+\overline{\text{p6}})\cdot (\overline{\text{q5}}+\overline{\text{q6}})\right)
\end{dmath*}

For the expansion of \texttt{Eps} tensors, we use

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{LC}\OperatorTok{[][}\NormalTok{p1 }\SpecialCharTok{+}\NormalTok{ p2}\OperatorTok{,} \FunctionTok{q}\OperatorTok{,} \FunctionTok{r}\OperatorTok{,} \FunctionTok{s}\OperatorTok{]}
\NormalTok{EpsEvaluate}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\bar{\epsilon }^{\overline{\text{p1}}+\overline{\text{p2}}\overline{q}\overline{r}\overline{s}}
\end{dmath*}

\begin{dmath*}\breakingcomma
\bar{\epsilon }^{\overline{\text{p1}}\overline{q}\overline{r}\overline{s}}+\bar{\epsilon }^{\overline{\text{p2}}\overline{q}\overline{r}\overline{s}}
\end{dmath*}

\texttt{EpsEvaluate} also reorders the arguments of \texttt{Eps}
according to its antisymmetric properties

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{LC}\OperatorTok{[}\SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{],} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Sigma}\OperatorTok{],} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Rho}\OperatorTok{],} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Nu}\OperatorTok{]]}
\NormalTok{EpsEvaluate}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\bar{\epsilon }^{\mu \sigma \rho \nu }
\end{dmath*}

\begin{dmath*}\breakingcomma
-\bar{\epsilon }^{\mu \nu \rho \sigma }
\end{dmath*}

The inverse of \texttt{ExpandScalarProduct} is called
\texttt{MomentumCombine}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3}\NormalTok{ FV}\OperatorTok{[}\FunctionTok{p}\OperatorTok{,} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{]]} \SpecialCharTok{+} \DecValTok{4}\NormalTok{ FV}\OperatorTok{[}\FunctionTok{q}\OperatorTok{,} \SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{]]}
\NormalTok{MomentumCombine}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
3 \overline{p}^{\mu }+4 \overline{q}^{\mu }
\end{dmath*}

\begin{dmath*}\breakingcomma
\left(3 \overline{p}+4 \overline{q}\right)^{\mu }
\end{dmath*}

This also works for scalar products, but the results may not be always
optimal

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SP}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q} \SpecialCharTok{+} \FunctionTok{t}\OperatorTok{,} \FunctionTok{r} \SpecialCharTok{+} \FunctionTok{s}\OperatorTok{]}
\NormalTok{ExpandScalarProduct}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\NormalTok{MomentumCombine}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
(\overline{r}+\overline{s})\cdot (\overline{p}+\overline{q}+\overline{t})
\end{dmath*}

\begin{dmath*}\breakingcomma
\overline{p}\cdot \overline{r}+\overline{p}\cdot \overline{s}+\overline{q}\cdot \overline{r}+\overline{q}\cdot \overline{s}+\overline{r}\cdot \overline{t}+\overline{s}\cdot \overline{t}
\end{dmath*}

\begin{dmath*}\breakingcomma
(\overline{r}+\overline{s})\cdot (\overline{p}+\overline{q}+\overline{t})
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SP}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q} \SpecialCharTok{+} \FunctionTok{t}\OperatorTok{,} \FunctionTok{r} \SpecialCharTok{+} \FunctionTok{s}\OperatorTok{]} \SpecialCharTok{+}\NormalTok{ SP}\OperatorTok{[}\FunctionTok{r}\OperatorTok{,} \FunctionTok{s}\OperatorTok{]}
\NormalTok{ExpandScalarProduct}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\NormalTok{MomentumCombine}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
(\overline{r}+\overline{s})\cdot (\overline{p}+\overline{q}+\overline{t})+\overline{r}\cdot \overline{s}
\end{dmath*}

\begin{dmath*}\breakingcomma
\overline{p}\cdot \overline{r}+\overline{p}\cdot \overline{s}+\overline{q}\cdot \overline{r}+\overline{q}\cdot \overline{s}+\overline{r}\cdot \overline{s}+\overline{r}\cdot \overline{t}+\overline{s}\cdot \overline{t}
\end{dmath*}

\begin{dmath*}\breakingcomma
(\overline{p}+\overline{q})\cdot (\overline{r}+\overline{s})+\overline{r}\cdot (\overline{s}+\overline{t})+\overline{s}\cdot \overline{t}
\end{dmath*}

For Dirac matrices the corresponding functions are
\texttt{DiracGammaExpand} and \texttt{DiracGammaCombine}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{GA}\OperatorTok{[}\SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{]]}\NormalTok{ . GS}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q}\OperatorTok{]}\NormalTok{ . GA}\OperatorTok{[}\SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Nu}\OperatorTok{]]}\NormalTok{ . GS}\OperatorTok{[}\FunctionTok{r} \SpecialCharTok{+} \FunctionTok{s}\OperatorTok{]}
\NormalTok{DiracGammaExpand}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\NormalTok{DiracGammaCombine}\OperatorTok{[}\SpecialCharTok{\%}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \left(\overline{p}+\overline{q}\right)\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \left(\overline{r}+\overline{s}\right)\right)
\end{dmath*}

\begin{dmath*}\breakingcomma
\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \overline{p}+\bar{\gamma }\cdot \overline{q}\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \overline{r}+\bar{\gamma }\cdot \overline{s}\right)
\end{dmath*}

\begin{dmath*}\breakingcomma
\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \left(\overline{p}+\overline{q}\right)\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \left(\overline{r}+\overline{s}\right)\right)
\end{dmath*}

Notice the \texttt{DiracGammaExpand} does not expand the whole
noncommutative product. If you need that, use \texttt{DotSimplify}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{GA}\OperatorTok{[}\SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Mu}\OperatorTok{]]}\NormalTok{ . GS}\OperatorTok{[}\FunctionTok{p} \SpecialCharTok{+} \FunctionTok{q}\OperatorTok{]}\NormalTok{ . GA}\OperatorTok{[}\SpecialCharTok{\textbackslash{}}\OperatorTok{[}\NormalTok{Nu}\OperatorTok{]]}\NormalTok{ . GS}\OperatorTok{[}\FunctionTok{r} \SpecialCharTok{+} \FunctionTok{s}\OperatorTok{]}
\SpecialCharTok{\%} \SpecialCharTok{//}\NormalTok{ DiracGammaExpand }\SpecialCharTok{//}\NormalTok{ DotSimplify}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \left(\overline{p}+\overline{q}\right)\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \left(\overline{r}+\overline{s}\right)\right)
\end{dmath*}

\begin{dmath*}\breakingcomma
\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \overline{p}\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \overline{r}\right)+\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \overline{p}\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \overline{s}\right)+\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \overline{q}\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \overline{r}\right)+\bar{\gamma }^{\mu }.\left(\bar{\gamma }\cdot \overline{q}\right).\bar{\gamma }^{\nu }.\left(\bar{\gamma }\cdot \overline{s}\right)
\end{dmath*}
\end{document}
