% !TeX program = pdflatex
% !TeX root = FCToTeXReorder.tex

\documentclass[../FeynCalcManual.tex]{subfiles}
\begin{document}
\hypertarget{fctotexreorder}{
\section{FCToTeXReorder}\label{fctotexreorder}\index{FCToTeXReorder}}

\texttt{FCToTeXReorder[\allowbreak{}exp,\ \allowbreak{}\{\allowbreak{}\{\allowbreak{}v1,\ \allowbreak{}v2,\ \allowbreak{}... \},\ \allowbreak{}\{\allowbreak{}a1,\ \allowbreak{}a2,\ \allowbreak{}... \},\ \allowbreak{}\{\allowbreak{}b1,\ \allowbreak{}b2,\ \allowbreak{}... \}\}]}
is an auxiliary function that helps to bring the given Mathematica
expression \texttt{exp} into a form suitable for being inserted into a
LaTeX document.

To override the built-in ordering of \texttt{Plus} and \texttt{Times},
the expression is converted into a nested list made of elements of the
form
\texttt{\{\allowbreak{}a,\ \allowbreak{}b,\ \allowbreak{}... ,\ \allowbreak{}Plus\}}
or
\texttt{\{\allowbreak{}a,\ \allowbreak{}b,\ \allowbreak{}... ,\ \allowbreak{}Times\}}
for a sum or a product respectively.

Then, the option \texttt{SortBy} allows to specify two sorting functions
that will be used to reorder the terms in both groups.

Most importantly, \texttt{FCToTeXReorder} can be applied to the output
of a previous function call. This allows for arbitrarily deep nesting.

Finally, you can check if the final result satisfies your expectations
by using \texttt{FCToTeXPreviewTermOrder}.

\subsection{See also}

\hyperlink{toc}{Overview},
\hyperlink{fctotexpreviewtermorder}{FCToTeXPreviewTermOrder}.

\subsection{Examples}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{exp} \ExtensionTok{=}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{13629} \SpecialCharTok{{-}} \DecValTok{4452}\SpecialCharTok{*}\NormalTok{L1 }\SpecialCharTok{+} \DecValTok{24}\SpecialCharTok{*}\NormalTok{L2 }\SpecialCharTok{+} \DecValTok{380}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{+} \DecValTok{75}\SpecialCharTok{*}\NormalTok{L1}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{+} \DecValTok{130}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{+} \DecValTok{150}\SpecialCharTok{*}\NormalTok{L1}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{+} 
      \DecValTok{130}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{+} \DecValTok{150}\SpecialCharTok{*}\NormalTok{L1}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{+} \DecValTok{20}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{{-}} \DecValTok{75}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{NH}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{+} \DecValTok{360}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} \DecValTok{66300}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} 
      \DecValTok{20628}\SpecialCharTok{*}\NormalTok{L1}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{648}\SpecialCharTok{*}\NormalTok{L2}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{450}\SpecialCharTok{*}\NormalTok{NL}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{900}\SpecialCharTok{*}\NormalTok{NV}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{72}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{2592}\SpecialCharTok{*}\FunctionTok{z}\SpecialCharTok{*}\FunctionTok{Log}\OperatorTok{[}\FunctionTok{z}\OperatorTok{]}\NormalTok{)}\SpecialCharTok{/}\DecValTok{81}\NormalTok{;}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aux1 }\ExtensionTok{=}\NormalTok{ FCToTeXReorder}\OperatorTok{[}\FunctionTok{exp}\OperatorTok{,} \OperatorTok{\{\{}\FunctionTok{z}\OperatorTok{\},} \OperatorTok{\{}\FunctionTok{Log}\OperatorTok{,}\NormalTok{ L1}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{\},} \OperatorTok{\{}\FunctionTok{Log}\OperatorTok{,}\NormalTok{ L1}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{\}\}]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left\{\left\{\frac{2}{27} z \left(75 \;\text{NL}+150 \;\text{NV}+12 \pi ^2+11050\right),\{8 z,\text{L2},\text{Times}\},\{32 z,\log (z),\text{Times}\},\left\{\frac{764 z}{3},\text{L1},\text{Times}\right\},\text{Plus}\right\},\left\{\frac{1}{81} \left(-75 \sqrt{3} \pi  \;\text{NH}+380 \;\text{NH}+130 \;\text{NL}+130 \;\text{NV}+360 \pi ^2+20 \sqrt{3} \pi -13629\right),\left\{\frac{8}{27},\text{L2},\text{Times}\right\},\left\{\frac{1}{27} (25 \;\text{NH}+50 \;\text{NL}+50 \;\text{NV}-1484),\text{L1},\text{Times}\right\},\text{Plus}\right\},\text{Plus}\right\}
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aux1 }\SpecialCharTok{//}\NormalTok{ FCToTeXPreviewTermOrder}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left(\frac{2}{27} \left(11050+75 \;\text{NL}+150 \;\text{NV}+12 \pi ^2\right) z+8 z \;\text{L2}+32 z \log (z)+\frac{764 z \;\text{L1}}{3}\right)+\left(\frac{1}{81} \left(-13629+380 \;\text{NH}+130 \;\text{NL}+130 \;\text{NV}+20 \sqrt{3} \pi -75 \sqrt{3} \;\text{NH} \pi +360 \pi ^2\right)+\frac{8 \;\text{L2}}{27}+\frac{1}{27} (-1484+25 \;\text{NH}+50 \;\text{NL}+50 \;\text{NV}) \;\text{L1}\right)
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aux1 }\SpecialCharTok{//} \FunctionTok{InputForm}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\OperatorTok{\{\{}\NormalTok{(}\DecValTok{2}\SpecialCharTok{*}\NormalTok{(}\DecValTok{11050} \SpecialCharTok{+} \DecValTok{75}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{+} \DecValTok{150}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{+} \DecValTok{12}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}\SpecialCharTok{*}\FunctionTok{z}\NormalTok{)}\SpecialCharTok{/}\DecValTok{27}\OperatorTok{,} \OperatorTok{\{}\DecValTok{8}\SpecialCharTok{*}\FunctionTok{z}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{,} \FunctionTok{Times}\OperatorTok{\},} 
  \OperatorTok{\{}\DecValTok{32}\SpecialCharTok{*}\FunctionTok{z}\OperatorTok{,} \FunctionTok{Log}\OperatorTok{[}\FunctionTok{z}\OperatorTok{],} \FunctionTok{Times}\OperatorTok{\},} \OperatorTok{\{}\NormalTok{(}\DecValTok{764}\SpecialCharTok{*}\FunctionTok{z}\NormalTok{)}\SpecialCharTok{/}\DecValTok{3}\OperatorTok{,}\NormalTok{ L1}\OperatorTok{,} \FunctionTok{Times}\OperatorTok{\},} \FunctionTok{Plus}\OperatorTok{\},} 
 \OperatorTok{\{}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{13629} \SpecialCharTok{+} \DecValTok{380}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{+} \DecValTok{130}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{+} \DecValTok{130}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{+} \DecValTok{20}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{{-}} 
    \DecValTok{75}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{NH}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{+} \DecValTok{360}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}\SpecialCharTok{/}\DecValTok{81}\OperatorTok{,} \OperatorTok{\{}\DecValTok{8}\SpecialCharTok{/}\DecValTok{27}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{,} \FunctionTok{Times}\OperatorTok{\},} 
  \OperatorTok{\{}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1484} \SpecialCharTok{+} \DecValTok{25}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{+} \DecValTok{50}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{+} \DecValTok{50}\SpecialCharTok{*}\NormalTok{NV)}\SpecialCharTok{/}\DecValTok{27}\OperatorTok{,}\NormalTok{ L1}\OperatorTok{,} \FunctionTok{Times}\OperatorTok{\},} \FunctionTok{Plus}\OperatorTok{\},} \FunctionTok{Plus}\OperatorTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res }\ExtensionTok{=}\NormalTok{ FCToTeXReorder}\OperatorTok{[}\NormalTok{aux1}\OperatorTok{,} \OperatorTok{\{\{}\NormalTok{L1}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{\},} \OperatorTok{\{}\NormalTok{NH}\OperatorTok{,}\NormalTok{ NV}\OperatorTok{,}\NormalTok{ NL}\OperatorTok{\},} \OperatorTok{\{}\NormalTok{NH}\OperatorTok{,}\NormalTok{ NV}\OperatorTok{,}\NormalTok{ NL}\OperatorTok{\}\}]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left\{\left\{\left\{\frac{4}{27} \left(5525+6 \pi ^2\right) z,\left\{\frac{50 z}{9},\text{NL},\text{Times}\right\},\left\{\frac{100 z}{9},\text{NV},\text{Times}\right\},\text{Plus}\right\},\{8 z,\text{L2},\text{Times}\},\{32 z,\log (z),\text{Times}\},\left\{\frac{764 z}{3},\text{L1},\text{Times}\right\},\text{Plus}\right\},\left\{\left\{\frac{1}{81} \left(-13629+20 \sqrt{3} \pi +360 \pi ^2\right),\left\{\frac{130}{81},\text{NL},\text{Times}\right\},\left\{\frac{130}{81},\text{NV},\text{Times}\right\},\left\{\frac{5}{81} \left(76-15 \sqrt{3} \pi \right),\text{NH},\text{Times}\right\},\text{Plus}\right\},\left\{\frac{8}{27},\text{L2},\text{Times}\right\},\left\{\left\{-\frac{1484}{27},\left\{\frac{25}{27},\text{NH},\text{Times}\right\},\left\{\frac{50}{27},\text{NL},\text{Times}\right\},\left\{\frac{50}{27},\text{NV},\text{Times}\right\},\text{Plus}\right\},\text{L1},\text{Times}\right\},\text{Plus}\right\},\text{Plus}\right\}
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res }\SpecialCharTok{//}\NormalTok{ FCToTeXPreviewTermOrder}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left(\left(\frac{4}{27} \left(5525+6 \pi ^2\right) z+\frac{50 z \;\text{NL}}{9}+\frac{100 z \;\text{NV}}{9}\right)+8 z \;\text{L2}+32 z \log (z)+\frac{764 z \;\text{L1}}{3}\right)+\left(\left(\frac{1}{81} \left(-13629+20 \sqrt{3} \pi +360 \pi ^2\right)+\frac{130 \;\text{NL}}{81}+\frac{130 \;\text{NV}}{81}+\frac{5}{81} \left(76-15 \sqrt{3} \pi \right) \;\text{NH}\right)+\frac{8 \;\text{L2}}{27}+\left(-\frac{1484}{27}+\frac{25 \;\text{NH}}{27}+\frac{50 \;\text{NL}}{27}+\frac{50 \;\text{NV}}{27}\right) \;\text{L1}\right)
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{exp} \ExtensionTok{=}\NormalTok{ ((L2}\SpecialCharTok{*}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5} \SpecialCharTok{+}\NormalTok{ nc)}\SpecialCharTok{*}\NormalTok{(}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ nc)}\SpecialCharTok{*}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{32}\SpecialCharTok{*}\NormalTok{nc }\SpecialCharTok{{-}} \DecValTok{32}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}\SpecialCharTok{/}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{+}\NormalTok{ (L1}\SpecialCharTok{*}\NormalTok{(}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ nc)}\SpecialCharTok{*}\NormalTok{(}\DecValTok{672}\SpecialCharTok{*}\NormalTok{nc }\SpecialCharTok{+} \DecValTok{256}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} 
          \DecValTok{32}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{{-}} \DecValTok{40}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{{-}} \DecValTok{80}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{{-}} \DecValTok{80}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NV))}\SpecialCharTok{/}\NormalTok{(}\DecValTok{3}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ nc)}\SpecialCharTok{*}\NormalTok{(}\DecValTok{14544}\SpecialCharTok{*}\NormalTok{nc }\SpecialCharTok{+} 
          \DecValTok{7872}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{{-}} \DecValTok{1440}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{{-}} \DecValTok{1216}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{{-}} \DecValTok{416}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{{-}} \DecValTok{416}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{{-}} \DecValTok{192}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{+} 
          \DecValTok{240}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NH}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{{-}} \DecValTok{384}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{{-}} \DecValTok{1440}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NV}\SpecialCharTok{*}\FunctionTok{z}\NormalTok{))}\SpecialCharTok{/}\NormalTok{(}\DecValTok{36}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} 
\NormalTok{      ((}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ nc)}\SpecialCharTok{*}\NormalTok{(}\DecValTok{14544}\SpecialCharTok{*}\NormalTok{nc }\SpecialCharTok{+} \DecValTok{7872}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{{-}} \DecValTok{1440}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3} \SpecialCharTok{{-}} \DecValTok{1216}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NH }\SpecialCharTok{{-}} \DecValTok{416}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NL }\SpecialCharTok{{-}} 
           \DecValTok{416}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NV }\SpecialCharTok{{-}} \DecValTok{192}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{+} \DecValTok{240}\SpecialCharTok{*}\FunctionTok{Sqrt}\OperatorTok{[}\DecValTok{3}\OperatorTok{]}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NH}\SpecialCharTok{*}\FunctionTok{Pi} \SpecialCharTok{{-}} \DecValTok{384}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} 
           \DecValTok{11520}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{15984}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{+} \DecValTok{3312}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{{-}} \DecValTok{1440}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NL}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{{-}} \DecValTok{2880}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\NormalTok{NV}\SpecialCharTok{*}\FunctionTok{z} \SpecialCharTok{{-}} 
           \DecValTok{768}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\SpecialCharTok{*}\FunctionTok{Pi}\SpecialCharTok{\^{}}\DecValTok{2}\SpecialCharTok{*}\FunctionTok{z}\NormalTok{))}\SpecialCharTok{/}\NormalTok{(}\DecValTok{36}\SpecialCharTok{*}\NormalTok{nc}\SpecialCharTok{\^{}}\DecValTok{3}\NormalTok{))}\SpecialCharTok{/}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\frac{1}{2} \left(\frac{\text{L1} (\text{nc}+1) \left(32 \;\text{nc}^3-40 \;\text{nc}^2 \;\text{NH}-80 \;\text{nc}^2 \;\text{NL}-80 \;\text{nc}^2 \;\text{NV}+256 \;\text{nc}^2+672 \;\text{nc}\right)}{3 \;\text{nc}^3}+\frac{\text{L2} (\text{nc}-5) (\text{nc}+1) \left(-32 \;\text{nc}^2-32 \;\text{nc}\right)}{\text{nc}^3}+\frac{1}{36 \;\text{nc}^3}(\text{nc}+1) \left(-384 \pi ^2 \;\text{nc}^3-1440 \;\text{nc}^3-1216 \;\text{nc}^2 \;\text{NH}+240 \sqrt{3} \pi  \;\text{nc}^2 \;\text{NH}-416 \;\text{nc}^2 \;\text{NL}-1440 \;\text{nc}^2 \;\text{NV} z-416 \;\text{nc}^2 \;\text{NV}+7872 \;\text{nc}^2-192 \sqrt{3} \pi  \;\text{nc}+14544 \;\text{nc}\right)+\frac{1}{36 \;\text{nc}^3}(\text{nc}+1) \left(-768 \pi ^2 \;\text{nc}^3 z+3312 \;\text{nc}^3 z-384 \pi ^2 \;\text{nc}^3-1440 \;\text{nc}^3-1216 \;\text{nc}^2 \;\text{NH}+240 \sqrt{3} \pi  \;\text{nc}^2 \;\text{NH}-1440 \;\text{nc}^2 \;\text{NL} z-416 \;\text{nc}^2 \;\text{NL}-2880 \;\text{nc}^2 \;\text{NV} z-416 \;\text{nc}^2 \;\text{NV}+15984 \;\text{nc}^2 z+7872 \;\text{nc}^2+11520 \;\text{nc} z-192 \sqrt{3} \pi  \;\text{nc}+14544 \;\text{nc}\right)\right)
\end{dmath*}

Split into pieces that depend on \texttt{L1}, \texttt{L2} and those then
don' t . Then collect terms in the first group w.r.t
\texttt{L1,\ \allowbreak{}L2} . Collect terms in the second group
\texttt{w.r.t.}z\texttt{. Use}ExpandAll\texttt{as the factoring function in both groups . Sort the resulting terms in the first group such,\ \allowbreak{}that terms containing}L1\texttt{come first,\ \allowbreak{}then those with}L2\texttt{and finally all the rest . Put terms that depend on}z`
in the second group first .

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out1 }\ExtensionTok{=}\NormalTok{ FCToTeXReorder}\OperatorTok{[}\FunctionTok{exp}\OperatorTok{,} \OperatorTok{\{\{}\NormalTok{L1}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{\},} \OperatorTok{\{}\NormalTok{L1}\OperatorTok{,}\NormalTok{ L2}\OperatorTok{\},} \OperatorTok{\{}\FunctionTok{z}\OperatorTok{\}\},} \FunctionTok{Split} \OtherTok{{-}\textgreater{}} \ConstantTok{True}\OperatorTok{,}\NormalTok{ Factoring }\OtherTok{{-}\textgreater{}} \OperatorTok{\{}\FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} 
      \FunctionTok{ExpandAll}\OperatorTok{[}\FunctionTok{x}\OperatorTok{]],} \FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{ExpandAll}\OperatorTok{[}\FunctionTok{x}\OperatorTok{]]\},} \FunctionTok{SortBy} \OtherTok{{-}\textgreater{}} \OperatorTok{\{}\FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{Which}\OperatorTok{[}\NormalTok{! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{L1}\OperatorTok{\}],} \DecValTok{1}\OperatorTok{,} 
\NormalTok{       ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{L2}\OperatorTok{\}],} \DecValTok{2}\OperatorTok{,} \ConstantTok{True}\OperatorTok{,} \DecValTok{30}\OperatorTok{]],} \FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{Which}\OperatorTok{[}\NormalTok{! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\FunctionTok{z}\OperatorTok{\}],} \DecValTok{1}\OperatorTok{,} \ConstantTok{True}\OperatorTok{,} \DecValTok{3}\OperatorTok{]]\}]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left\{\left\{\left\{\frac{112}{\text{nc}^2}-\frac{20 \;\text{NH}}{3 \;\text{nc}}-\frac{40 \;\text{NL}}{3 \;\text{nc}}-\frac{40 \;\text{NV}}{3 \;\text{nc}}+\frac{16 \;\text{nc}}{3}+\frac{464}{3 \;\text{nc}}-\frac{20 \;\text{NH}}{3}-\frac{40 \;\text{NL}}{3}-\frac{40 \;\text{NV}}{3}+48,\text{L1},\text{Times}\right\},\left\{\frac{80}{\text{nc}^2}-16 \;\text{nc}+\frac{144}{\text{nc}}+48,\text{L2},\text{Times}\right\},\text{Plus}\right\},\left\{\left\{\frac{160}{\text{nc}^2}-\frac{20 \;\text{NL}}{\text{nc}}-\frac{60 \;\text{NV}}{\text{nc}}-\frac{32 \pi ^2 \;\text{nc}}{3}+46 \;\text{nc}+\frac{382}{\text{nc}}-20 \;\text{NL}-60 \;\text{NV}-\frac{32 \pi ^2}{3}+268,z,\text{Times}\right\},-\frac{16 \pi }{\sqrt{3} \;\text{nc}^2}+\frac{404}{\text{nc}^2}-\frac{304 \;\text{NH}}{9 \;\text{nc}}+\frac{20 \pi  \;\text{NH}}{\sqrt{3} \;\text{nc}}-\frac{104 \;\text{NL}}{9 \;\text{nc}}-\frac{104 \;\text{NV}}{9 \;\text{nc}}-\frac{32 \pi ^2 \;\text{nc}}{3}-40 \;\text{nc}-\frac{16 \pi }{\sqrt{3} \;\text{nc}}+\frac{1868}{3 \;\text{nc}}-\frac{304 \;\text{NH}}{9}+\frac{20 \pi  \;\text{NH}}{\sqrt{3}}-\frac{104 \;\text{NL}}{9}-\frac{104 \;\text{NV}}{9}-\frac{32 \pi ^2}{3}+\frac{536}{3},\text{Plus}\right\},\text{Plus}\right\}
\end{dmath*}

Now work with the innermost brackets and put terms that contain
\texttt{z} first . All the other terms should be sorted, such that
\texttt{NH}, \texttt{NV} and \texttt{NL} terms appear in this order.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{out2 }\ExtensionTok{=}\NormalTok{ FCToTeXReorder}\OperatorTok{[}\NormalTok{out1}\OperatorTok{,} \OperatorTok{\{\{\},} \OperatorTok{\{\},} \OperatorTok{\{\}\},} \FunctionTok{Split} \OtherTok{{-}\textgreater{}} \ConstantTok{False}\OperatorTok{,}\NormalTok{ Factoring }\OtherTok{{-}\textgreater{}} \OperatorTok{\{}\FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{ExpandAll}\OperatorTok{[}\FunctionTok{x}\OperatorTok{]],} 
     \FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{ExpandAll}\OperatorTok{[}\FunctionTok{x}\OperatorTok{]]\},} \FunctionTok{SortBy} \OtherTok{{-}\textgreater{}} \OperatorTok{\{}\FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{Which}\OperatorTok{[}\NormalTok{! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\FunctionTok{z}\OperatorTok{\}],} \DecValTok{1}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NH}\OperatorTok{\}],} 
       \DecValTok{2}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NV}\OperatorTok{\}],} \DecValTok{3}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NL}\OperatorTok{\}],} \DecValTok{4}\OperatorTok{,} \ConstantTok{True}\OperatorTok{,} \DecValTok{5}\OperatorTok{]],} \FunctionTok{Function}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \FunctionTok{Which}\OperatorTok{[}\NormalTok{! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\FunctionTok{z}\OperatorTok{\}],} 
       \DecValTok{1}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NH}\OperatorTok{\}],} \DecValTok{2}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NV}\OperatorTok{\}],} \DecValTok{3}\OperatorTok{,}\NormalTok{ ! FreeQ2}\OperatorTok{[}\FunctionTok{x}\OperatorTok{,} \OperatorTok{\{}\NormalTok{NL}\OperatorTok{\}],} \DecValTok{4}\OperatorTok{,} \ConstantTok{True}\OperatorTok{,} \DecValTok{5}\OperatorTok{]]\}]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left\{\left\{\left\{\left\{-\frac{20 \;\text{NH}}{3},-\frac{20 \;\text{NH}}{3 \;\text{nc}},-\frac{40 \;\text{NV}}{3},-\frac{40 \;\text{NV}}{3 \;\text{nc}},-\frac{40 \;\text{NL}}{3},-\frac{40 \;\text{NL}}{3 \;\text{nc}},48,\frac{112}{\text{nc}^2},\frac{464}{3 \;\text{nc}},\frac{16 \;\text{nc}}{3},\text{Plus}\right\},\text{L1},\text{Times}\right\},\left\{\left\{48,\frac{80}{\text{nc}^2},\frac{144}{\text{nc}},-16 \;\text{nc},\text{Plus}\right\},\text{L2},\text{Times}\right\},\text{Plus}\right\},\left\{\left\{\left\{-60 \;\text{NV},-\frac{60 \;\text{NV}}{\text{nc}},-20 \;\text{NL},-\frac{20 \;\text{NL}}{\text{nc}},268,\frac{160}{\text{nc}^2},\frac{382}{\text{nc}},46 \;\text{nc},-\frac{32 \pi ^2}{3},-\frac{32 \pi ^2 \;\text{nc}}{3},\text{Plus}\right\},z,\text{Times}\right\},\left\{-\frac{304 \;\text{NH}}{9},-\frac{304 \;\text{NH}}{9 \;\text{nc}},\frac{20 \pi  \;\text{NH}}{\sqrt{3}},\frac{20 \pi  \;\text{NH}}{\sqrt{3} \;\text{nc}},-\frac{104 \;\text{NV}}{9},-\frac{104 \;\text{NV}}{9 \;\text{nc}},-\frac{104 \;\text{NL}}{9},-\frac{104 \;\text{NL}}{9 \;\text{nc}},\frac{536}{3},\frac{404}{\text{nc}^2},\frac{1868}{3 \;\text{nc}},-40 \;\text{nc},-\frac{16 \pi }{\sqrt{3} \;\text{nc}^2},-\frac{16 \pi }{\sqrt{3} \;\text{nc}},-\frac{32 \pi ^2}{3},-\frac{32 \pi ^2 \;\text{nc}}{3},\text{Plus}\right\},\text{Plus}\right\},\text{Plus}\right\}
\end{dmath*}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{FCToTeXPreviewTermOrder}\OperatorTok{[}\NormalTok{out2}\OperatorTok{]}
\end{Highlighting}
\end{Shaded}

\begin{dmath*}\breakingcomma
\left(\left(-\frac{20 \;\text{NH}}{3}-\frac{20 \;\text{NH}}{3 \;\text{nc}}-\frac{40 \;\text{NV}}{3}-\frac{40 \;\text{NV}}{3 \;\text{nc}}-\frac{40 \;\text{NL}}{3}-\frac{40 \;\text{NL}}{3 \;\text{nc}}+48+\frac{112}{\text{nc}^2}+\frac{464}{3 \;\text{nc}}+\frac{16 \;\text{nc}}{3}\right) \;\text{L1}+\left(48+\frac{80}{\text{nc}^2}+\frac{144}{\text{nc}}-16 \;\text{nc}\right) \;\text{L2}\right)+\left(\left(-60 \;\text{NV}-\frac{60 \;\text{NV}}{\text{nc}}-20 \;\text{NL}-\frac{20 \;\text{NL}}{\text{nc}}+268+\frac{160}{\text{nc}^2}+\frac{382}{\text{nc}}+46 \;\text{nc}-\frac{32 \pi ^2}{3}-\frac{32 \;\text{nc} \pi ^2}{3}\right) z+\left(-\frac{304 \;\text{NH}}{9}-\frac{304 \;\text{NH}}{9 \;\text{nc}}+\frac{20 \;\text{NH} \pi }{\sqrt{3}}+\frac{20 \;\text{NH} \pi }{\sqrt{3} \;\text{nc}}-\frac{104 \;\text{NV}}{9}-\frac{104 \;\text{NV}}{9 \;\text{nc}}-\frac{104 \;\text{NL}}{9}-\frac{104 \;\text{NL}}{9 \;\text{nc}}+\frac{536}{3}+\frac{404}{\text{nc}^2}+\frac{1868}{3 \;\text{nc}}-40 \;\text{nc}-\frac{16 \pi }{\sqrt{3} \;\text{nc}^2}-\frac{16 \pi }{\sqrt{3} \;\text{nc}}-\frac{32 \pi ^2}{3}-\frac{32 \;\text{nc} \pi ^2}{3}\right)\right)
\end{dmath*}
\end{document}
